# Приложение 1. Приложение для анализа банковских транзакций
Выбранные задачи по категориям:
1. Веб-страницы: Главная
2. Сервисы: Поиск переводов физическим лицам
3. Отчеты: Траты по категории


Содержит модули:
- *views.py* - Веб-страница: "Главная"
- *utils.py* - функции для работы модуля views.py
- *services.py* - Сервисы: Поиск переводов физическим лицам
- *reports.py* - Отчеты: Траты по категории
- *main.py* -  Пример использования функционала проета с выводом в консоль

# Важно!
- ТЕСТЫ запускать из папки tests (cd tests)
- Файл с данными о транзакиях operations.xlsx должен находиться в папке data.
- Файл с настройками пользователя user_settings.json, хранящий валюты и тикеры, дожен находиться в корне проекта.  
Пример содеожимого user_settings.json:   
*{  
 "user_currencies": ["USD", "EUR"],  
 "user_stocks": ["AAPL", "AMZN", "GOOGL", "MSFT", "TSLA"]  
}*
- Файл переменных окружения .env должен находиться в корне проекта. Образец - .env.example

## Функции
### Модуль views
- функция *main* - главная функция "Веб-страницы". Принимает дату в формате "YYYY-MM-DD HH:MM:SS". Возвращает JSON-строку   
 Пример использования: `main("2024-09-17 20:14:30")`

### Модуль utils
- функция *get_user_settings* - функция чтения фала с настройками пользователя user_settings.json.   
Возвращает словарь с ключами "user_currencies", "user_stocks"
- функция *get_greeting* - возвращает строку приветствия в зависимости от времени.   
Принимает дату в формате YYYY-MM-DD HH:MM:SS. Если не указать - значение по умолчанию текущее время
- функция *reading_data_excel* - читает файл operations.xlsx из директории data.   
Возвращает DataFrame.
- функция *get_data_for_month_excel* - функция фильтрует операции от начала месяца до указанной даты.   
Принимает дату в формате YYYY-MM-DD HH:MM:SS. Возвращает DataFrame (столбец "Дата операции" - datetime).   
Данные берет из функции *reading_data_excel*
- функция *get_card_info* - функция аггрегирует данные по картам. Принимает DataFrame. Возвращает список словарей с   
данными по каждой карте: "last_digits": 4 цифры карты, "total_spent": общая сумма расходов, "cashback": сумма кешбека
- функция *get_top_transactions* - возвращает ТОП-n транзакций. Принимает транзакции в DataFrame и n. По умолчанию n=5.   
Возвращает список словарей с данными: "date": Дата операции, "amount": Сумма операции, "category": Категория, "description": Описание.   
- функция *get_exchange_rate* - функция получения курса валют по отношению к RUB с сайта https://api.apilayer.com/exchangerates_data/.  
Принимает список строк с кодом валют. Возвращает список словарей: "currency": код валюты, "rate": цена в RUB.
Ключ хранится в .env
- функция *get_stock_quotes* - функция получения текущих котировок по финансовым инструментам (акции, валютные пары) с   
сайта https://www.alphavantage.co/. Принимает список строк с тикерами инструментов. Возвращает список словарей: "stock": тикер, "price": цена.   
Ключ хранится в .env  

### Модуль services
- функция *get_transfer_to_individual* - функция поиск переводов физическим лицам.   
Принимает транзакции в виде списка словарей. Возвращает JSON-строку. 

### Модуль reports
- функция *spending_by_category* - функция отбора трат по указанной категории за последние 3 месяца от указанной даты.   
Принимает транзакции DataFrame, категорию, дату в формате YYYY.MM.DD. Если дата не указана, берется текущая.
- функция *three_month_ago* - функция возвращающая datetime на 3 месяца раньше. Принимает datetime
- декоратор *save_result* - сохраняет результаты работы функции в файл JSON. Принимает название файла (по умолчанию   
<название_функции>.json).  Функция для обертывания должна возвращать JSON-строку.

### Модуль main
Запуск модуля *main* заставляет использовать весь функционал проекта. Выводит в терминал результаты работы функций модулей:  
*views* (в том числе модуля *utils*), *reoprts* и *servisec*.  
При этом используются файлы *operations.xlsx, user_settings.json, .env* и сторонние API.  
Генерируется файл *spending_by_category.json* с результатами работы функции *spending_by_category*

## Зависимости и конфигурация
black==24.8.0
certifi==2024.8.30
charset-normalizer==3.3.2
click==8.1.7
colorama==0.4.6
coverage==7.6.1
et-xmlfile==1.1.0
flake8==7.1.1
idna==3.8
iniconfig==2.0.0
isort==5.13.2
mccabe==0.7.0
mypy==1.11.2
mypy-extensions==1.0.0
numpy==2.1.1
openpyxl==3.1.5
packaging==24.1
pandas==2.2.2
pathspec==0.12.1
platformdirs==4.3.3
pluggy==1.5.0
pycodestyle==2.12.1
pyflakes==3.2.0
pytest==8.3.2
pytest-cov==5.0.0
python-dateutil==2.9.0.post0
python-dotenv==1.0.1
pytz==2024.1
requests==2.32.3
six==1.16.0
typing_extensions==4.12.2
tzdata==2024.1
urllib3==2.2.2

## Инструкция по установке
Чтобы скачать репозиторий:  
`git clone https://github.com/AleksandrG-dot/Project_1.git`

*Для установки зависимостей выполните команду:  
`pip install -r requirements.txt`

## Тестирование
- pytest: ТЕСТЫ ЗАПУСКАТЬ из папки tests (cd tests)
- Модуль тестирования: pytest==8.3.2  
- Количество тестов: 33
- Code coverage: 93%